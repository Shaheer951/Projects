CREATE DATABASE IF NOT EXISTS BYTHEBOOK;

USE BYTHEBOOK;

CREATE TABLE IF NOT EXISTS BOOK (

	ISBN13 CHAR(13) PRIMARY KEY,
	PAGES CHAR(4) NOT NULL,
	PRICE DECIMAL (6, 2) NOT NULL,
	DESCRIPTION TEXT NOT NULL,
	TITLE VARCHAR (30) NOT NULL,
	LANGUAGE VARCHAR(20) NOT NULL,
	RATING DECIMAL(3, 2),
	BOOK_IMG VARCHAR(100) NOT NULL,
	QUANTITY INT NOT NULL

);

CREATE TABLE IF NOT EXISTS AUTHOR (

	AUTHOR_ID VARCHAR(15) PRIMARY KEY,
	NAME VARCHAR (30) NOT NULL,
	DESCRIPTION TEXT NOT NULL,
	DOB DATE

);

CREATE TABLE IF NOT EXISTS PERSON (

	USER_ID VARCHAR(15) PRIMARY KEY,
	NAME VARCHAR(30) NOT NULL,
	ADDRESS VARCHAR(50) NOT NULL,
	DOB DATE NOT NULL,
	EMAIL VARCHAR(50) NOT NULL,
	PASSWORD VARCHAR(15)

);

CREATE TABLE IF NOT EXISTS GENRE (

	GENRE_ID VARCHAR(15) PRIMARY KEY,
	GENRE VARCHAR(15) NOT NULL

);


CREATE TABLE IF NOT EXISTS PUBLISHER (

	PUB_ID VARCHAR (15) PRIMARY KEY,
	NAME VARCHAR(30) NOT NULL,
	ADDRESS VARCHAR(50) NOT NULL,
	DESCRIPTION TEXT NOT NULL

);



CREATE TABLE IF NOT EXISTS PURCHASEORDER (

	ORDER_ID INT,
	USER_ID VARCHAR(15),
	QUANTITY INT NOT NULL,
	ORDER_DATE DATE NOT NULL,

	PRIMARY KEY(ORDER_ID, USER_ID),
	FOREIGN KEY(USER_ID) REFERENCES PERSON(USER_ID) ON DELETE SET NULL

);


CREATE TABLE IF NOT EXISTS REVIEW (

	REVIEW_ID VARCHAR(15) NOT NULL,
	ISBN13 CHAR(13) NOT NULL,  
	CONTENT TEXT NOT NULL,

	PRIMARY KEY(REVIEW_ID, ISBN13),
	FOREIGN KEY (ISBN13) REFERENCES BOOK(ISBN13) ON DELETE CASCADE

);


CREATE TABLE IF NOT EXISTS ORDER_USER (

	USER_ID VARCHAR(15),
	ORDER_ID INT,

	PRIMARY KEY(USER_ID, ORDER_ID),
	FOREIGN KEY(USER_ID) REFERENCES PERSON(USER_ID),
	FOREIGN KEY(ORDER_ID) REFERENCES PURCHASEORDER(ORDER_ID)

);

CREATE TABLE IF NOT EXISTS BOOK_GENRE (

	ISBN13 CHAR(13),
	GENRE_ID VARCHAR(15),

	PRIMARY KEY(ISBN13, GENRE_ID),
	FOREIGN KEY(ISBN13) REFERENCES BOOK(ISBN13),
	FOREIGN KEY(GENRE_ID) REFERENCES GENRE(GENRE_ID)

);

CREATE TABLE IF NOT EXISTS AUTHOR_BOOK (

	ISBN13 CHAR(13),
	AUTHOR_ID VARCHAR(15),

	PRIMARY KEY(ISBN13, AUTHOR_ID),
	FOREIGN KEY(ISBN13) REFERENCES BOOK(ISBN13),
	FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHOR(AUTHOR_ID)


);

CREATE TABLE IF NOT EXISTS AUTHOR_GENRE (

	GENRE_ID VARCHAR(15), 
	AUTHOR_ID VARCHAR(15),

	PRIMARY KEY(GENRE_ID, AUTHOR_ID),
	FOREIGN KEY(GENRE_ID) REFERENCES GENRE(GENRE_ID),
	FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHOR(AUTHOR_ID)

);


CREATE TABLE IF NOT EXISTS BOOK_PUBLISHER (

	ISBN13 CHAR(13) NOT NULL,
	PUB_ID VARCHAR(15) NOT NULL,
	PUB_DATE DATE NOT NULL,

	PRIMARY KEY(ISBN13, PUB_ID),
	FOREIGN KEY(ISBN13) REFERENCES BOOK(ISBN13),
	FOREIGN KEY(PUB_ID) REFERENCES PUBLISHER(PUB_ID)

);

CREATE TABLE IF NOT EXISTS ORDER_BOOK (

	ISBN13 CHAR(13),
	ORDER_ID INT,

	PRIMARY KEY(ISBN13, ORDER_ID),
	FOREIGN KEY (ISBN13) REFERENCES BOOK(ISBN13),
	FOREIGN KEY (ORDER_ID) REFERENCES PURCHASEORDER(ORDER_ID)

);

CREATE TABLE IF NOT EXISTS USER_FAVOURITE_AUTHOR (

    AUTHOR_ID VARCHAR(15),
    USER_ID VARCHAR(15),
    FAV_DATE DATE NOT NULL,

    PRIMARY KEY(AUTHOR_ID, USER_ID),
    FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHOR(AUTHOR_ID),
    FOREIGN KEY(USER_ID) REFERENCES PERSON(USER_ID)

);


CREATE TABLE IF NOT EXISTS USER_RATING(

	ISBN13 CHAR(13),
	USER_ID VARCHAR(15),
	RATING DECIMAL(4, 2) NOT NULL,

	PRIMARY KEY(ISBN13, USER_ID),
	FOREIGN KEY(ISBN13) REFERENCES BOOK(ISBN13),
	FOREIGN KEY(USER_ID) REFERENCES PERSON(USER_ID)

);

CREATE TABLE IF NOT EXISTS USER_REVIEW (

	USER_ID VARCHAR(15),
	ISBN13 CHAR(13),
	review_date DATE,
	REVIEW_ID VARCHAR(15),

	PRIMARY KEY (USER_ID, REVIEW_ID),
	FOREIGN KEY (ISBN13) REFERENCES BOOK(ISBN13) ON DELETE CASCADE
)